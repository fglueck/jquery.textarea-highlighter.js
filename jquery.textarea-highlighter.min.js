/**
 * jquery.textarea-highlighter.js
 * jQuery plugin for highlighting text in textarea.
 * version: 0.4.7
 * update: 2014-11-12
 * author: alexandre.kirillov@gmail.com
 *
 * MIT license. http://opensource.org/licenses/MIT
 */
!function(a,b,c){"use strict";function d(b,d){this.isInited=!1,this.element=b,this.$element=a(this.element),this.settings=a.extend({},f,this.$element.data(),d),this._defaults=f,this._name=e,this.style={},this.$wrapDiv=a(c.createElement("div")).addClass("textarea-highlighter-wrap"),this.$backgroundDiv=a(c.createElement("div")),this.$autoSize=a('<pre><div class="autosize"></div></pre>').hide(),this.$autoSizeElement=this.$autoSize.find(".autosize"),this.init()}var e="textareaHighlighter",f={matches:[],maxlength:-1,maxlengthWarning:"",maxlengthElement:null,debug:!1,isAutoExpand:!0,typingDelay:30};d.prototype={init:function(){var a=this,b=this.$element,c=this.settings,d=this.$wrapDiv,e=this.$backgroundDiv;if(a.updateStyle(),b.data("highlighterTimerId",-1).on("scroll.textarea.highlighter",function(){e.scrollTop(b.scrollTop())}).on("textarea.highlighter.highlight.text",function(b,c){e.html(a.getWrapedText(e.html(),g.escapeHTML(c.txt),c.className))}).on("textarea.highlighter.destroy",function(){a.destroy()}).on("textarea.highlighter.matches",function(b,c){a.settings.matches=c.matches,a.change({})}).on("textarea.highlighter.updateStyle",function(){a.updateStyle(),a.updateHeight()}).on("textarea.highlighter.change",function(){a.change({})}).on("textarea.highlighter.debug.on",function(){a.debugModeOn()}).on("textarea.highlighter.debug.off",function(){a.debugModeOff()}),"onpropertychange"in a.element)if("oninput"in a.element){b.on("input.textarea.highlighter keyup.textarea.highlighter",function(b){a.change(b)});var f=(new Date).getTime(),h=0;b.on("keydown.textarea.highlighter",function(b){h=Math.abs(f-(new Date).getTime()),8===b.which&&(10>h||h>250)&&(a.change(b),f=(new Date).getTime())})}else b.on("propertychange.textarea.highlighter",function(b){a.change(b)});else b.on("input.textarea.highlighter",function(b){a.change(b)});b.wrap(d).before(e),c.isAutoExpand&&b.after(a.$autoSize),a.change({})},updateStyle:function(){var a=this,b=this.$element,c=this.settings,d=this.style;d={paddingTop:parseInt(b.css("padding-top"),10),paddingRight:parseInt(b.css("padding-right"),10),paddingBottom:parseInt(b.css("padding-bottom"),10),paddingLeft:parseInt(b.css("padding-left"),10)},h.firefox&&(d.paddingRight+=1,d.paddingLeft+=1),h.iphone&&(d.paddingRight+=3,d.paddingLeft+=3),this.$wrapDiv.css({position:"relative"}),this.$backgroundDiv.addClass("background-div").addClass(b.attr("class")).css({"font-family":"inherit",color:c.debug?"#f00":"transparent",background:c.debug?"#fee":d.background,position:"absolute",height:"100%","padding-top":d.paddingTop,"padding-right":d.paddingRight,"padding-bottom":d.paddingBottom,"padding-left":d.paddingLeft}),a.cloneCSSToTarget(a.$backgroundDiv),a.$autoSize.addClass(b.attr("class")).css({"font-family":"inherit",position:"absolute",top:0,left:0,"padding-top":d.paddingTop,"padding-right":d.paddingRight,"padding-bottom":d.paddingBottom,"padding-left":d.paddingLeft}),a.cloneCSSToTarget(a.$autoSize),b.css({color:c.debug?"rgba(0,0,0,0.5)":"inherit",position:"relative",background:"transparent"})},change:function(a){var b=this,c=b.settings;if(/(37|38|39|40)/.test(a.keyCode))return!0;b.isInited&&b.updateHeight(),-1!==b.$element.data("highlighterTimerId")&&(clearTimeout(b.$element.data("highlighterTimerId")),b.$element.data("highlighterTimerId",-1));var d=setTimeout(function(){var a=b.checkMaxLength(),c=b.checkMatchWords(a.notOverMaxText);b.$backgroundDiv.html(c.txt+a.overMaxText),b.$element.trigger("textarea.highlighter.update",{textList:c.matchedList}),b.isInited||(b.isInited=!0,b.$element.trigger("textarea.highlighter.init.complete"),b.updateHeight())},c.typingDelay);b.$element.data("highlighterTimerId",d)},getWrapedText:function(a,b,c){var d=this,e=g.escapeRegExp(b);return a.replace(new RegExp("("+e+'|<(?:(?!\\sclass="|>).)+\\sclass="*"[^>]*>|<\\/[^>]+>)',"g"),function(){return b===arguments[0]?d.getTextInSpan(c,b):arguments[0]})},getTextInSpan:function(a,b){return'<span class="'+a+'">'+b+"</span>"},checkMaxLength:function(){var a=this,b=a.$element.val(),c=a.settings,d=0,e="",f="";return 0<c.maxlength?(c.maxlength<b.length&&(e=b.slice(c.maxlength,c.maxlength+b.length-1),e=g.escapeHTML(e),e=a.getTextInSpan(c.maxlengthWarning,e)),null!==c.maxlengthElement&&(d=c.maxlength-b.length,0>d?c.maxlengthElement.hasClass(c.maxlengthWarning)||c.maxlengthElement.addClass(c.maxlengthWarning):c.maxlengthElement.hasClass(c.maxlengthWarning)&&c.maxlengthElement.removeClass(c.maxlengthWarning),c.maxlengthElement.text(d)),f=b.slice(0,c.maxlength)):f=b,{overMaxText:e,notOverMaxText:g.escapeHTML(f)}},checkMatchWords:function(a){var b=this.settings,c=0,d=0,e=0,f=0,h=[],i=[],j="",k="",l="",m=null;for(c=0,d=b.matches.length;d>c;c++)for(h=b.matches[c].match instanceof RegExp?g.getUniqueArray(a.match(b.matches[c].match)||[]):b.matches[c].match,e=0,f=h.length;f>e;e++)j=h[e],k=g.escapeHTML(j),l="",m=a.match(new RegExp(g.escapeRegExp(k),"g")),m&&0<m.length&&(i.push({text:j,matched:m}),b.matches[c].hasOwnProperty("matchClass")&&(l=b.matches[c].matchClass),a=this.getWrapedText(a,k,l));return{txt:a,matchedList:i}},updateHeight:function(){var a=this;a.settings.isAutoExpand&&(a.$autoSizeElement.html(g.escapeHTML(a.$element.val().replace(/\r\n/g,"\n"))+" "),a.$element.height()!==a.$autoSize.height()&&a.$element.height(a.$autoSize.height()))},cloneCSSToTarget:function(b){var c=this.$element,d=null;a.each(g.cloneCSSProperties,function(a,e){d=c.css(e),b.css(e)!==d&&b.css(e,d)})},destroy:function(){a.data(this.element,"plugin_"+e,!1),this.$backgroundDiv.remove(),this.$autoSize.remove(),this.$element.data("highlighterTimerId",-1).off("scroll.textarea.highlighter").off("input.textarea.highlighter").off("keyup.textarea.highlighter").off("propertychange.textarea.highlighter").off("textarea.highlighter.init.complete").off("textarea.highlighter.destroy").off("textarea.highlighter.update").off("textarea.highlighter.updateStyle").off("textarea.highlighter.change").off("textarea.highlighter.debug.on").off("textarea.highlighter.debug.off").attr("style","").unwrap()},debugModeOn:function(){this.settings.debug=!0,this.$backgroundDiv.css({color:"#f00"}),this.$element.css({color:"rgba(0,0,0,0.5)"})},debugModeOff:function(){this.settings.debug=!1,this.$backgroundDiv.css({color:"transparent"}),this.$element.css({color:"inherit"})}},a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})};var g={escapeHTML:function(a){var b=c.createElement("div");return b.appendChild(c.createTextNode(a)),b.innerHTML},escapeRegExp:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},getUniqueArray:function(a){return a.filter(function(a,b,c){return""===a?!1:c.indexOf(a)===b})},cloneCSSProperties:["lineHeight","textDecoration","letterSpacing","fontSize","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","wordWrap","word-break","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","boxSizing","webkitBoxSizing","mozBoxSizing","msBoxSizing"]},h=function(){var a=navigator.userAgent,b=/(msie|trident)/i.test(a),c=/chrome/i.test(a),d=/firefox/i.test(a),e=/safari/i.test(a)&&!c,f=/iphone/i.test(a);return b?{msie:!0}:c?{chrome:!0}:d?{firefox:!0}:f?{iphone:!0}:e?{safari:!0}:{msie:!1,chrome:!1,firefox:!1,safari:!1,iphone:!1}}()}(jQuery,window,document);