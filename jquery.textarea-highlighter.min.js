/**
 * jquery.textarea-highlighter.js - jQuery plugin for highlighting text in textarea.
 * @version v0.6.0
 * @link https://github.com/marexandre/jquery.textarea-highlighter.js
 * @author alexandre.kirillov@gmail.com
 * @license MIT license. http://opensource.org/licenses/MIT
 */
var marexandre;!function(e){"use strict";var t=function(){function e(){}return e.prototype.orderBy=function(e,t){return e.sort(function(e,n){return parseInt(e[t],10)-parseInt(n[t],10)})},e.prototype.removeOverlapingIndecies=function(e){for(var t,n,i=[],r=0,a=e.length;a>r;r++){t=e[r];for(var o=r+1;a>o;o++)n=e[o],this.isOverlap(t,n)&&i.push(o)}return e.slice(0).filter(function(e,t){return-1!==i.indexOf(t)?!1:!0})},e.prototype.removeOverlapingIndeciesByPriority=function(e){e=e||[],e=this.orderBy(e,"priority");for(var t,n,i=[],r=0,a=e.length;a>r;r++){t=e[r];for(var o=r+1;a>o;o++)if(n=e[o],this.isOverlap(t,n)){if(t.priority<n.priority){i.push(r);break}if(t.priority===n.priority){if(!(t.end>n.end||t.start<n.start)){i.push(r);break}i.push(o)}else i.push(o)}}return e.slice(0).filter(function(e,t){return-1!==i.indexOf(t)?!1:!0})},e.prototype.isOverlap=function(e,t){return e.start<t.end&&t.start<e.end},e.prototype.flattenIndeciesList=function(e){for(var t,n,i=[],r=0,a=e.length;a>r;r++){t=e[r].type;for(var o=0,s=e[r].indecies.length;s>o;o++)n=e[r].indecies[o],i.push({start:n.start,end:n.end,type:t})}return i},e.prototype.cleanupOnWordBoundary=function(e,t,n){n=n||!0;for(var i,r,a,o=[],s=0,h=t.length;h>s;s++)i=t[s],r=e.slice(i.start,i.end),a=e.slice(i.start-1,i.end+1),n&&this.isWrappedByASCII(r)&&!this.checkWordBoundary(r,a)&&o.push(s);return t.slice(0).filter(function(e,t){return-1!==o.indexOf(t)?!1:!0})},e.prototype.makeTokenized=function(e,t){for(var n,i=[],r=0,a=0,o=0,s=t.length;s>o;o++)n=t[o],a=n.start,a>r&&i.push({value:e.slice(r,a),type:"text"}),i.push({value:e.slice(a,n.end),type:n.type}),r=n.end;return r<e.length&&i.push({value:e.slice(r,e.length),type:"text"}),i},e.prototype.checkWordBoundary=function(e,t){return new RegExp("\\b"+this.escapeRegExp(e)+"\\b").test(t)},e.prototype.isWrappedByASCII=function(e){return/^\w.*\w$|^\w+$/.test(e)},e.prototype.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},e.prototype.escapeRegExp=function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},e.prototype.sanitizeBreakLines=function(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")},e.prototype.getUniqueArray=function(e){return e.filter(function(e,t,n){return""===e?!1:n.indexOf(e)===t})},e.prototype.createHTML=function(e){for(var t=[],n=0,i=e.length;i>n;n++)t.push("text"===e[n].type?e[n].value:this.getTextInSpan(e[n].type,e[n].value));return t.join("")},e.prototype.getTextInSpan=function(e,t){return'<span class="'+e+'">'+t+"</span>"},e.prototype.browser=function(){var e=navigator.userAgent,t=/(msie|trident)/i.test(e),n=/chrome/i.test(e),i=/firefox/i.test(e),r=/safari/i.test(e)&&!n,a=/iphone/i.test(e);return t?{msie:!0}:n?{chrome:!0}:i?{firefox:!0}:a?{iphone:!0}:r?{safari:!0}:{msie:!1,chrome:!1,firefox:!1,safari:!1,iphone:!1}},e}();e.Helper=t}(marexandre||(marexandre={}));var marexandre;!function(e){"use strict";var t=function(){function e(e){this.list={children:{}},this.addFromArray(e||[])}return e.prototype.addFromArray=function(e){for(var t=this,n=0,i=e.length;i>n;n++)t.add(e[n])},e.prototype.add=function(e){for(var t=this,n=t.list,i=0,r=e.length;r>i;i++){var a=e[i];null==n.children[a]&&(n.children[a]={children:{},value:a,is_end:i===r-1}),n=n.children[a]}},e.prototype.hasWord=function(e){for(var t=this,n=t.list.children,i=!1,r=0,a=e.length;a>r;r++){var o=e[r],s=n.hasOwnProperty(o.toString());if(!s)break;if(n[o].is_end&&r===a-1){i=!0;break}n=n[o].children}return i},e.prototype.getIndecies=function(e){for(var t=this,n=[],i="",r=t.list,a=-1,o=-1,s=0,h=e.length;h>s;s++){i=e.slice(s);for(var g=0,p=i.length;p>g;g++){var l=i[g],d=r.children.hasOwnProperty(l.toString());if(!d)break;if(r=r.children[l],a=s,!i[g+1]){if(r.is_end){o=a+g;break}break}var c=r.children.hasOwnProperty(i[g+1].toString());if(r.is_end&&!c){o=a+g;break}}-1!==a&&-1!==o&&(n.push({start:a,end:o+1}),s=o),a=-1,o=-1,r=t.list}return n},e}();e.Trie=t}(marexandre||(marexandre={}));var marexandre;!function(e,t,n){"use strict";var i="textareaHighlighter",r=new marexandre.Helper,a=function(t,i){this.$element=t,this.element=this.$element[0],this.settings=e.extend({},a.DEFAULTS,this.$element.data(),i),this.$wrapDiv=e(n.createElement("div")).addClass("textarea-highlighter-wrap"),this.$backgroundDiv=e(n.createElement("div")).addClass("background-div "+this.$element.attr("class")),this.$autoSize=e('<pre><div class="autosize"></div></pre>').addClass(this.$element.attr("class")).hide(),this.$autoSizeElement=this.$autoSize.find(".autosize"),this.init()};a.DEFAULTS={word_base:!0,matches:[],maxlength:-1,maxlengthWarning:"",maxlengthElement:null,isAutoExpand:!0,typingDelay:30,debug:!1},a.prototype.init=function(){for(var e=this,t=this.$element,n=this.settings,i=this.$wrapDiv,a=this.$backgroundDiv,o=0,s=n.matches.length;s>o;o++)n.matches[o].match=r.getUniqueArray(n.matches[o].match);e.updateStyle(),t.wrap(i).before(a),n.isAutoExpand&&t.after(e.$autoSize),e.updateHeight(),e.bindEvents(),e.highlight()},a.prototype.bindEvents=function(){var e=this,t=this.$element;if(t.data("highlighterTimerId",-1).on("scroll.textarea.highlighter",function(){e.$backgroundDiv.scrollTop(t.scrollTop())}),"onpropertychange"in e.element)if("oninput"in e.element){t.on("input.textarea.highlighter keyup.textarea.highlighter",function(t){e.change(t)});var n=(new Date).getTime(),i=0;t.on("keydown.textarea.highlighter",function(t){i=Math.abs(n-(new Date).getTime()),8===t.which&&(10>i||i>250)&&(e.change(t),n=(new Date).getTime())})}else t.on("propertychange.textarea.highlighter",function(t){e.change(t)});else t.on("input.textarea.highlighter",function(t){e.change(t)})},a.prototype.change=function(e){var t=this;if(/(37|38|39|40)/.test(e.keyCode))return!0;t.updateHeight(),-1!==t.$element.data("highlighterTimerId")&&(clearTimeout(t.$element.data("highlighterTimerId")),t.$element.data("highlighterTimerId",-1));var n=setTimeout(function(){t.highlight()},t.settings.typingDelay);t.$element.data("highlighterTimerId",n)},a.prototype.highlight=function(){var e=this,t=e.$element.val(),n=e.settings,i="",a="";return 0===t.length?void e.$backgroundDiv.html(""):(0<n.maxlength?(n.maxlength<t.length&&(i=t.slice(n.maxlength,n.maxlength+t.length-1),i=r.escapeHTML(i),i=r.getTextInSpan(n.maxlengthWarning,i)),e.updateCharLimitElement(t),a=t.slice(0,n.maxlength)):a=t,a=r.escapeHTML(a),a=e.getHighlightedContent(a),void e.$backgroundDiv.html(a+i))},a.prototype.getHighlightedContent=function(e){for(var t,n,i,a=this,o=a.settings.matches,s=[],h=0,g=o.length;g>h;h++)t=o[h],t._trie?n=t._trie:(n=new marexandre.Trie(t.match),t._trie=n),i=n.getIndecies(e),i=r.removeOverlapingIndecies(i),s.push({indecies:i,type:t.matchClass});var p=r.flattenIndeciesList(s);p=r.orderBy(p,"start"),p=r.removeOverlapingIndecies(p),p=r.cleanupOnWordBoundary(e,p,a.settings.word_base);var l=r.makeTokenized(e,p);return r.createHTML(l)},a.prototype.updateCharLimitElement=function(e){var t=this,n=t.settings;if(null!==n.maxlengthElement){var i=n.maxlength-e.length;0>i?n.maxlengthElement.hasClass(n.maxlengthWarning)||n.maxlengthElement.addClass(n.maxlengthWarning):n.maxlengthElement.hasClass(n.maxlengthWarning)&&n.maxlengthElement.removeClass(n.maxlengthWarning),n.maxlengthElement.text(i)}},a.prototype.updateMatches=function(e){var t=this;t.settings.matches=e,t.highlight()},a.prototype.updateStyle=function(){var e=this,t=this.$element,n=this.settings,i={paddingTop:parseInt(t.css("padding-top"),10),paddingRight:parseInt(t.css("padding-right"),10),paddingBottom:parseInt(t.css("padding-bottom"),10),paddingLeft:parseInt(t.css("padding-left"),10)};r.browser().iphone&&(i.paddingRight+=3,i.paddingLeft+=3),this.$wrapDiv.css({position:"relative"}),this.$backgroundDiv.css({position:"absolute",height:"100%","font-family":"inherit",color:n.debug?"#f00":"transparent","padding-top":i.paddingTop,"padding-right":i.paddingRight,"padding-bottom":i.paddingBottom,"padding-left":i.paddingLeft}),e.cloneCSSToTarget(e.$backgroundDiv),n.isAutoExpand&&(e.$autoSize.css({top:0,left:0,"font-family":"inherit",position:"absolute","padding-top":i.paddingTop,"padding-right":i.paddingRight,"padding-bottom":i.paddingBottom,"padding-left":i.paddingLeft}),e.cloneCSSToTarget(e.$autoSize)),t.css({color:n.debug?"rgba(0,0,0,0.5)":"inherit",position:"relative",background:"none"})},a.prototype.updateHeight=function(){var e=this;if(e.settings.isAutoExpand){e.$autoSizeElement.html(r.escapeHTML(r.sanitizeBreakLines(e.$element.val()))+" ");var t=e.$autoSize.height();e.$element.height()!==t&&(e.$element.height(t),e.$backgroundDiv.height(t))}},a.prototype.cloneCSSToTarget=function(t){var n=this.$element,i=["lineHeight","textDecoration","letterSpacing","fontSize","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","wordWrap","word-break","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","boxSizing","webkitBoxSizing","mozBoxSizing","msBoxSizing"],r=null;e.each(i,function(e,i){r=n.css(i),t.css(i)!==r&&t.css(i,r)})},a.prototype.destroy=function(){e.data(this.element,"plugin_"+i,!1),this.$backgroundDiv.remove(),this.$autoSize.remove(),this.$element.data("highlighterTimerId",-1).off("scroll.textarea.highlighter").off("input.textarea.highlighter").off("keyup.textarea.highlighter").off("propertychange.textarea.highlighter").attr("style","").unwrap()},a.prototype.debugModeOn=function(){this.settings.debug=!0,this.$backgroundDiv.css({color:"#f00"}),this.$element.css({color:"rgba(0,0,0,0.5)"})},a.prototype.debugModeOff=function(){this.settings.debug=!1,this.$backgroundDiv.css({color:"transparent"}),this.$element.css({color:"inherit"})},e.fn.textareaHighlighter=function(t){var n=arguments;return this.each(function(){var r=e(this),o=r.data(i),s="object"==typeof t&&t;o||(o=new a(r,s),r.data(i,o)),"string"==typeof t&&o[t].apply(o,Array.prototype.slice.call(n,1))})}}(jQuery,window,document);